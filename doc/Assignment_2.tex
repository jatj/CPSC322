\documentclass{article}

\usepackage{fullpage}
\usepackage{color}
\usepackage{amsmath}
\usepackage{url}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{parskip}
\usepackage{amssymb}
\usepackage{nicefrac}
\usepackage{algorithm2e} % pseudo-code
\usepackage{booktabs}
\usepackage{siunitx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{bookmark}
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage[procnames]{listings}

\def\rubric#1{\gre{Rubric: \{#1\}}}{}

% Colors
\definecolor{blu}{rgb}{0,0,1}
\def\blu#1{{\color{blu}#1}}
\definecolor{gre}{rgb}{0,.5,0}
\def\gre#1{{\color{gre}#1}}
\definecolor{red}{rgb}{1,0,0}
\def\red#1{{\color{red}#1}}
\definecolor{ans}{rgb}{0,.5,0}%{0.545,0.27,0.074}
\def\ans#1{{\color{ans}#1}}
\definecolor{keywords}{RGB}{255,0,90}
\definecolor{comments}{RGB}{0,0,113}
\definecolor{red}{RGB}{160,0,0}
\definecolor{green}{RGB}{0,150,0}
\def\norm#1{\|#1\|}

% Configuration
\usepackage[font={color=ans,bf},figurename=Fig.,labelfont={it}]{caption}
\lstset{
    language=Python, 
    basicstyle=\ttfamily\small, 
    keywordstyle=\color{keywords},
    commentstyle=\color{comments},
    stringstyle=\color{red},
    showstringspaces=false,
    identifierstyle=\color{green},
    procnamekeys={def,class}
}

% Math
\def\R{\mathbb{R}}
\def\argmax{\mathop{\rm arg\,max}}
\def\argmin{\mathop{\rm arg\,min}}
\newcommand{\mat}[1]{\begin{bmatrix}#1\end{bmatrix}}
\newcommand{\alignStar}[1]{\begin{align*}#1\end{align*}}
\def\half{\frac 1 2}
\def\cond{\; | \;}

% LaTeX
\newcommand{\fig}[2]{\includegraphics[width=#1\textwidth]{#2}}
\newcommand{\centerfig}[2]{\begin{center}\includegraphics[width=#1\textwidth]{#2}\end{center}}
\newcommand{\matCode}[1]{\lstinputlisting[language=Matlab]{a2f/#1.m}}
\def\items#1{\begin{itemize}#1\end{itemize}}
\def\enum#1{\begin{enumerate}#1\end{enumerate}}


\begin{document}

\title{CPSC 322 Assignment 1}
\author{
    Jose Abraham Torres Juarez - 79507828 \\
    Gustavo Martin - 62580121
}
\date{}
\maketitle
\vspace{-2em}

% ################################## QUESTION 1 ##################################

\section{Question 1 (21points): Allocating Developments Problem}

\begin{enumerate}[label=(\alph*)]
    \item Represent this problem as a CSP
    \begin{enumerate}\color{ans}
        \item \textbf{Variables: }
        \[
            \{ hc, bh, ra, gd \}
        \]
        \item \textbf{Domains: }
        \[
            \{ (0,0), (0,1), (0,2), (1,0), (1,1), (1,2), (2,0), (2,1), (2,2) \}
        \]
        \item \textbf{Constraints: }
        \[
            \{ hc \neq ra, hc \neq dg, hc \neq bh, bh \neq ra, bh \neq gd, ra \neq gd,
        \]
        \[
            hc \neq (0,0), bh \neq (0,0), ra \neq (0,0), gd \neq (0,0),
        \]
        \[
            hc \neq (1,2), bh \neq (1,2), ra \neq (1,2), gd \neq (1,2),
        \]
        \[
            !Close(hc,(0,0)), !Close(bh,(0,0)), !Close(hc,gd), !Close(bh,gd)
        \]
        \[
            Close(ra,(1,2)), Close(hc,ra), Close(bh,ra) \}
        \]
        \ans{
            For our constraint definitions we use the following functions:
        }
        \begin{tabbing}
        xxxx\=xxxx\=xxxx\=xxxx\=xxxx\= \kill \color{ans}
        {\bf Function} {\em Close} ($A,B$)\\ [0pt \color{ans}]
        \> // Check if $|| A - B ||_1$ == 1, the Manhattan distance must be 1\\
        \> return $( |A[0] - B[0]| + |A[1] - B[1]| ) == 1$ \\
        \end{tabbing}
    \end{enumerate}
    \item Draw a constraing graph for this problem
    \centerfig{0.8}{../figs/q1.png}
\end{enumerate}

% ################################## QUESTION 2 ##################################
\clearpage
\section{CSP - Search}
\begin{enumerate}[label=(\alph*)]
    \item Show how search can be used to solve this problem, using the variable ordering A, B, C, D, E, F, G, H. \\ 
    \ans{
        Number of fails: 1278 \\
        Number of solutions: 4Â \\
        Solutions:
        \begin{center}
        \begin{tabular}{|c|c|c|c|c|c|c|c|}
            \hline
            {A} & {B} & {C} & {D} & {E} & {F} & {G} & {H} \\
            \hline
            \hline
            3 & 3 & 4 & 3 & 1 & 2 & 3 & 4 \\
            \hline
            3 & 1 & 4 & 3 & 1 & 2 & 3 & 4 \\
            \hline
            2 & 2 & 3 & 4 & 2 & 1 & 2 & 3 \\
            \hline
            1 & 3 & 2 & 3 & 1 & 4 & 1 & 2 \\
            \hline
        \end{tabular}
        \end{center}
    }
    \ans{
        See \hyperref[appendix:CSP Search]{\textbf{Appendix A}} for the implementation of this \texttt{CSP}.\\
    }
    \item Is it  possible  to  generate a  smaller  tree? \\
    \ans{
        Yes by selecting in different order the variables we assign. \\ \\
        The heuristic we applied to our variable selection, was use first the variables that appear in 
        more constraints. By using this heuristic the tree had only \textbf{153} failing branches which is 
        much better than \textbf{1278} from the previous approach with alphabetical ordering. \\ \\
        The new order of the variable selection is: \\
        \[
            \{H, G, F, E, D, C, B, A\}
        \]
    }
    \item Explain why you expect the heuristic in part (b) to be good
    \ans{
        The branches in the search tree stop being searched if they are a failure or a solution, for this 
        problem we know that a solution will always be at the end on the tree, so we need to improve the 
        chance of having failures on shallow branches this will prevent us from doing unncessary processing 
        and will output a small tree. \\ \\
        By using the heuristic of assigning a value first to the variables that appear the most in 
        the constraints, we increase the chances for having a failing consistency check.
    }
\end{enumerate}

% ################################## QUESTION 3 ##################################
\clearpage
\section{CSP - Arc Consistency}
\begin{enumerate}[label=(\alph*)]
    \item Show how arc consistency can be used to solve the scheduling problem in Question 2
    \centerfig{0.7}{../figs/q3_a_1.jpeg}
    {
        \begin{center}\color{ans}
            Initial state
        \end{center}
    }
    \centerfig{0.7}{../figs/q3_a_2.jpeg}
    {
        \begin{center}\color{ans}
            Step 1: arc (H, G<H) was selected, 1 was removed from the domain of H.
        \end{center}
    }
    \centerfig{0.7}{../figs/q3_a_3.jpeg}
    {
        \begin{center}\color{ans}
            Step 2: arc (G, G<H) was selected, 4 was removed from the domain of G.
        \end{center}
    }
    \centerfig{0.7}{../figs/q3_a_4.jpeg}
    {
        \begin{center}\color{ans}
            Step 3: arc (C, |G-C|=1) was selected, nothing was removed.
        \end{center}
    }
    \centerfig{0.7}{../figs/q3_a_2.jpeg}
    {
        \begin{center}\color{ans}
            Step 4: arc (G, |G-C|=1) was selectec, nothing was removed.
        \end{center}
    }
    \centerfig{0.7}{../figs/q3_a_6.jpeg}
    {
        \begin{center}\color{ans}
            Final state
        \end{center}
    }
    \item Use domain splitting to solve this problem
    \centerfig{0.8}{../figs/q3_b.png}
    {
        \begin{center}\color{ans}
            Domain splitting graph
        \end{center}
    }
    \item Constraint satisfaction problems can become extremely large and complex. Given the choice between DFS with pruning and arc consistency with domain splitting, what (qualitatively) is the tradeoff between the two methods in terms of time/space complexity? \\ \\
    \ans{
        DFS with pruning is gonna have less space complexity than arc consistency with domain splitting, 
        because on DFS at worst you keep track of the value assigned to all eight variables, whereas with 
        arc consistency with domain splitting we have to track the domain of every variable separately. \\ \\
        On the other hand the domain splitting method works faster and arrive to a solution in fewer 
        steps rather than using DFS. We can recall that in the subsection 2.a, the implementation of 
        dfs with pruning had to do \textbf{1278} failing branches to get all the solutions, even by 
        using a heuristic for selecting the variable ordering in subsection 2.b got \textbf{153} failing 
        branches. The domain splitting method only had \textbf{5} failing branches as we can see on the 
        image above.
    }
\end{enumerate}

% ################################## QUESTION 4 ##################################
\clearpage
\section{CSP - Stochastic Local Search}
\begin{enumerate}[label=(\alph*)]
    \item For one particular run, make SLS select any variable that is involved in an unsatisfied constraint, and select a value that results in the minimum number of unsatisfied constraints. Report the initialized values.  At each step, report which variable is changed, its new value, and the resulting number of unsatisfied arcs. (You only need to do this for 5 steps).
    \ans{
    }
    \item Using batch runs, compare and explain the result of the following settings:
    \begin{enumerate}[label=(\roman*)]
        \item Select a variable involved in the maximum number of unsatisfied constraints, and the best value.
        \ans{
        }
        \item Select any variable that is involved in unsatisfied constraints, and the best value.
        \ans{
        }
        \item Select a variable at random, and the best value.
        \ans{
        }
        \item A probabilistic mix of i. and ii.Try a few probabilities and report on the best one you find
        \ans{
        }
    \end{enumerate}
    \item Pick one of the methods(ii)-(iv)from part (b) and run it repeatedly (5 runs should be enough, but you may do more runs if you wish). State which method you chose. Give a screenshot of the results; then think about, describe and explain whatyou observe.
    \ans{
    }
    \item How important is it to choose the value that results in the fewest unsatisfied constraints as opposed to choosing a value at random? Justify your answer with evidence.
    \ans{
    }
    \item For the best variable/best value method from part(b), allow random resets (for example, after 50 steps). Give a screenshot comparing the results to what happens if random resets are not allowed, and explain how this affects the performance of the algorithm, and why.
    \ans{
    }
\end{enumerate}

\bookmarksetup{startatroot}
\clearpage
\appendix

\section{Appendix: CSP as Search implementation}
\label{appendix:CSP Search}
\begin{center}
    \lstinputlisting{../code/q2.py}
\end{center}

\end{document}