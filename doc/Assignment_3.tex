\documentclass{article}

\usepackage{fullpage}
\usepackage{color}
\usepackage{amsmath}
\usepackage{url}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{parskip}
\usepackage{amssymb}
\usepackage{nicefrac}
\usepackage{algorithm2e} % pseudo-code
\usepackage{booktabs}
\usepackage{siunitx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{bookmark}
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage[procnames]{listings}
\usepackage{amssymb}
\usepackage{multicol}
\usepackage[linguistics]{forest}
\forestset{
sn edges/.style={
    for tree={
        rectangle, draw,
        s sep+ = 2pt,
        l sep+ = 25pt,
        parent anchor=south,
        edge path={
        \noexpand\path [\forestoption{edge}] (!u.parent anchor) -- ++(0,-15pt) -| (.child anchor)\forestoption{edge label};
        },
        edge={->}
    }
}
}

\def\rubric#1{\gre{Rubric: \{#1\}}}{}
\newcommand{\stripNot}[1]{$\overline{\text{#1}}$}

% Colors
\definecolor{blu}{rgb}{0,0,1}
\def\blu#1{{\color{blu}#1}}
\definecolor{gre}{rgb}{0,.5,0}
\def\gre#1{{\color{gre}#1}}
\definecolor{red}{rgb}{1,0,0}
\def\red#1{{\color{red}#1}}
\definecolor{ans}{rgb}{0,.5,0}%{0.545,0.27,0.074}
\def\ans#1{{\color{ans}#1}}
\definecolor{keywords}{RGB}{255,0,90}
\definecolor{comments}{RGB}{0,0,113}
\definecolor{red}{RGB}{160,0,0}
\definecolor{green}{RGB}{0,150,0}
\def\norm#1{\|#1\|}

% Configuration
\usepackage[font={color=ans,bf},figurename=Fig.,labelfont={it}]{caption}
\lstset{
    language=Python, 
    basicstyle=\ttfamily\small, 
    keywordstyle=\color{keywords},
    commentstyle=\color{comments},
    stringstyle=\color{red},
    showstringspaces=false,
    identifierstyle=\color{green},
    procnamekeys={def,class}
}

% Math
\def\R{\mathbb{R}}
\def\argmax{\mathop{\rm arg\,max}}
\def\argmin{\mathop{\rm arg\,min}}
\newcommand{\mat}[1]{\begin{bmatrix}#1\end{bmatrix}}
\newcommand{\alignStar}[1]{\begin{align*}#1\end{align*}}
\def\half{\frac 1 2}
\def\cond{\; | \;}

% LaTeX
\newcommand{\fig}[2]{\includegraphics[width=#1\textwidth]{#2}}
\newcommand{\centerfig}[2]{\begin{center}\includegraphics[width=#1\textwidth]{#2}\end{center}}
\newcommand{\matCode}[1]{\lstinputlisting[language=Matlab]{a2f/#1.m}}
\def\items#1{\begin{itemize}#1\end{itemize}}
\def\enum#1{\begin{enumerate}#1\end{enumerate}}


\begin{document}

\title{CPSC 322 Assignment 3}
\author{
    Jose Abraham Torres Juarez - 79507828 \\
    Gustavo Martin - 62580121
}
\date{}
\maketitle
\vspace{-2em}

% ################################## QUESTION 1 ##################################

\section{Question 1 [35 points]: Heuristics in STRIPS: a video game example}

\begin{enumerate}[label=(\alph*)]
    \item \textbf{4 points} Define the STRIPS features (variables) and their domains for this problem. \\
    
    \ans{
    		\begin{multicols}{2}
                agent\_has\_charge \{T/F\} \\
                agent\_not\_has\_charge \{T/F\} \\ \\
                agent\_loc1   \{T/F\} \\
                agent\_loc2   \{T/F\} \\
                agent\_loc3   \{T/F\} \\
                agent\_loc4   \{T/F\} \\
                agent\_loc5   \{T/F\} \\
                agent\_loc6   \{T/F\} \\
                agent\_loc7   \{T/F\} \\
                agent\_loc8   \{T/F\} \\
                agent\_loc9   \{T/F\} \\
                agent\_loc10   \{T/F\} \\ \\
                agent\_not\_loc1   \{T/F\} \\
                agent\_not\_loc2   \{T/F\} \\
                agent\_not\_loc3   \{T/F\} \\
                agent\_not\_loc4   \{T/F\} \\
                agent\_not\_loc5   \{T/F\} \\
                agent\_not\_loc6   \{T/F\} \\
                agent\_not\_loc7   \{T/F\} \\
                agent\_not\_loc8   \{T/F\} \\
                agent\_not\_loc9   \{T/F\} \\
                agent\_not\_loc10   \{T/F\} \\ \\
                one\_has\_charge \{T/F\} \\
                one\_not\_has\_charge \{T/F\} \\ \\
                four\_has\_charge \{T/F\} \\
                four\_not\_has\_charge \{T/F\} \\ \\
                three\_has\_enemy \{T/F\} \\
                three\_not\_has\_enemy \{T/F\} \\ \\
                nine\_has\_enemy \{T/F\} \\
                nine\_not\_has\_enemy \{T/F\} \\ \\
   		\end{multicols}
    } 
    \item \textbf{8 points} Give the STRIPS representation of the actions for location 4 (“moveRight4”, “moveLeft4”, pickUp4, and fire4). \\
    \ans{
        \textbf{moveRight4:}
        \begin{itemize}
            \item Preconditions:  agent\_loc\_4 = T
            \item Effects: agent\_loc\_4 = F, agent\_not\_loc\_4 = T, agent\_loc\_5 = T, agent\_not\_loc\_5 = F
        \end{itemize}
        \textbf{moveLeft4:}
        \begin{itemize}
            \item Preconditions:  agent\_loc\_4 = T, three\_not\_has\_enemy = T
            \item Effects: agent\_loc\_4 = F,  agent\_not\_loc\_4 = T, agent\_loc\_3 = T, agent\_not\_loc\_3 = F
        \end{itemize}
        \textbf{pickUp4:}
        \begin{itemize}
            \item Preconditions:  agent\_loc\_4 = T, four\_has\_charge = T 
            \item Effects: four\_has\_charge = F, four\_not\_has\_charge = T, agent\_has\_charge = T 
        \end{itemize}
        \textbf{fire4:}
        \begin{itemize}
            \item Preconditions: agent\_loc\_4 = T, agent\_has\_charge = T  
            \item Effects: agent\_has\_charge = F, agent\_not\_has\_charge = T, three\_has\_enemy = F,\\ three\_not\_has\_enemy = T, five\_has\_enemy = F, five\_not\_has\_enemy = T		 
        \end{itemize}
    }

    \item \textbf{6 points} Draw a part of the search space that includes the optimal plan\\
    \ans{
        \begin{center}
            \begin{forest}
                sn edges
                [ \text{ agent\_loc\_8, agent\_has\_charge, nine\_has\_enemy } 
                    [ \text{ agent\_loc\_7, agent\_has\_charge, nine\_has\_enemy, \stripNot{agent\_loc\_8} }, edge label={node[midway,fill=white,font=\scriptsize]{moveLeft8}} ]
                    [ \text{ agent\_loc\_8, \stripNot{agent\_has\_charge}, \stripNot{nine\_has\_enemy} }, edge label={node[midway,fill=white,font=\scriptsize]{fire8}} 
                        [ \text{ agent\_loc\_7, \stripNot{agent\_loc\_8} }, edge label={node[midway,fill=white,font=\scriptsize]{moveLeft8}}, before drawing tree={x-=50pt} ]
                        [ \text{ agent\_loc\_9, \stripNot{agent\_loc\_8} }, edge label={node[midway,fill=white,font=\scriptsize]{moveRight8}} 
                            [ \text{ agent\_loc\_8, \stripNot{agent\_loc\_9} }, edge label={node[midway,fill=white,font=\scriptsize]{moveLeft9}}, before drawing tree={x-=100pt} ]
                            [ \text{ agent\_loc\_10, \stripNot{agent\_loc\_9} }, edge label={node[midway,fill=white,font=\scriptsize]{moveRight9}}, before drawing tree={x-=100pt} ]
                        ]
                    ]
                ]
            \end{forest}
        \end{center}
    }
    \item \textbf{3 points} What is a good admissible heuristic for this planning goal? \\
    \ans{
        % The distance between the agents location and location 10, if the agent's weapon doesn't 
        % have a charge, we will also add the distance to the nearest charging location. This heuristic 
        % will not only provides a way to tell if the agent is getting closer to the location, but also 
        % takes into account that having a charge is necessary to reach the goal state. It is also 
        % admissible because it will always be an underestimate of the real cost
        The number of locations plus the number of enemies, between the agent's location and location 10. 
        This will give us the minimum number of moves and fires actions that the agent has to make to 
        reach the goal. Furthermore we can add 1 to the heuristic, if there is at least one enemy 
        between them and the agent doesn't have the weapon charged, so the agent has to do the pickup 
        action to load the weapon and then fire to the enemy that is between him and the goal. 
    }
    \item \textbf{2 points} What is the value of this heuristic for the state that has the agent in \\
    location 9, cells 3 and 9 free of monsters, the weapon charged and charges available in location 1 and 4? Represent this state using
    your features from (a), and justify your answer. \\ 
    \ans{
        \begin{center}
            \fbox{agent\_loc\_9, agent\_has\_charge, \stripNot{three\_has\_enemy}, \stripNot{nine\_has\_enemy}, one\_has\_charge, four\_has\_charge } 
        \end{center}
        In this state the distance between the agent and the goal is 1 and the number of enemies 
        between them is 0. So the heuristic in this state would be just 1.
    }
    \item \textbf{2 points} What is the value of this heuristic for the state that has the agent in \\
    location 8, monsters in both cell 3 and 9, the weapon charged and charges available in location 1 and 4? 
    Represent this state using your features from (a), and justify your answer. \\
    \ans{
        \begin{center}
            \fbox{agent\_loc\_8, agent\_has\_charge, three\_has\_enemy, nine\_has\_enemy, one\_has\_charge, four\_has\_charge } 
        \end{center}
        In this state the distance between the agent and the goal is 2 and the number of enemies 
        between them is 1. So the heuristic in this state would be 3.
    }
    \item \textbf{2 points} Why is this heuristic not very useful?\\
    \ans{
        Although this heuristic is admissible, and it gives a good estimate of the solution. The calculation 
        of this heuristic depends of knowing completely the state of the world. If we are uncertain if there 
        are enemies or not, the heuristic might become not very informative.
    }
    \item \textbf{3 points} What is the value of the ignore-delete-list heuristic for the state in (f)? Also give theoptimal plan for the relaxed problem (starting at the state in (f)). Justify your answer\\
     \ans{
         The heuristic in this state would be one. The agent just has to move to location 10 from 
         location 9 to reach the goal state.
    } \\
    \centerfig{0.75}{../figs/1-h.png}
	\item \textbf{3 points} What is the value of the ignore-delete-list heuristic for the state in (e)? Also give the optimal plan for the relaxed problem (starting at the state in (e)). Justify your answer\\
        \ans{
       The heuristic in this state would be three. The agent can fire from location 8 to destroy the 
       enemy on cell 9 and keep it's weapon charged. Then, the agent moves from location 8 to location 
       9 and finally to location 10.
    } \\
    \centerfig{0.75}{../figs/1-i.png}
	\item \textbf{2 points} Is this heuristic more useful than ignoring preconditions? Why or why not? \\
     \ans{
        Yes, this heuristic provides us a more realistic simplified version of the problem 
    }
    
\end{enumerate}

% ################################## QUESTION 2 ##################################
\clearpage
\section{Question 2 [38 points]: STRIPS representation}
The DrinkUp Bartendering school just opened, so it only has two students (Jane and Laura), one small cocktail shaker that can only make one cocktail at a time, and one cocktail glass. Both Jane and Laura need to practice making cocktails that require having a base of shaken Vodka. Jane will use this to make a blue cocktail with Blue Curacao (Blue for short), Laura to make a pink one with Berry Liqueur (Berry for short). The cocktail glass needs to be clean when making a new cocktail. They will only make more shaken vodka base when there is no more left. \\ \\
Figure 1 shows the STRIPS representation for this problem.
\centerfig{1}{../figs/fig1.png}
Load the applet at \texttt{http\://aispace.org/strips\_to\_csp/}, and load the file cocktail.xml containing this STRIPS problem.
\begin{enumerate}[label=(\alph*)]
    \item \textbf{6 points} List the variables/features that define the states in the problem, as well as their domains.\\
    \ans{
        \begin{multicols}{2}
            - HaveVodkaBase \{T,F\} \\
            - PracticedLaura \{T,F\} \\
            - HaveBerry \{T,F\} \\
            - HaveBlue \{T,F\} \\
            - PracticedJane \{T,F\} \\
            - CleanGlass \{T,F\} \\
        \end{multicols}
    }
    \item \textbf{8 points} List the actions in this problem, with their preconditions and effects.\\
    \ans{
        \textbf{MakeBlue: }
        \begin{itemize}
            \item Preconditions: \{ HaveVodkaBase = T, CleanGlass = T, HaveBlue = T \}
            \item Effects: \{ HaveVodkaBase = F, PracticedJane = T, CleanGlass = F \}
        \end{itemize}
        \textbf{MakeBerry: }
        \begin{itemize}
            \item Preconditions: \{ HaveVodkaBase = T, CleanGlass = T, HaveBerry = T \}
            \item Effects: \{ HaveVodkaBase = F, PracticedLaura = T, CleanGlass = F \}
        \end{itemize}
        \textbf{WashGlass: }
        \begin{itemize}
            \item Preconditions: \{ CleanGlass = F \}
            \item Effects: \{ CleanGlass = T \}
        \end{itemize}
        \textbf{MakeVodkaBase: }
        \begin{itemize}
            \item Preconditions: \{ HaveVodkaBase = F \}
            \item Effects: \{ HaveVodkaBase = T \}
        \end{itemize}
    }
    \item \textbf{1 point} Convert this STRIPS problem to a CSP planning problem with a horizon of 1. We suggest that you first try to set up the constraints network by yourself, but you can check your solution in the applet by clicking “Solve” and then “Solve with Arc Consistency”. Show a screenshot of the network thus obtained. (Note: if the network appears cramped, you can enlarge the window and then select View->Autoscale to spread it out; you may still need to move around some of the nodes to make it easier to read.)\\
    \centerfig{1}{../figs/q2_1.png}
    \item \textbf{6 points} Show a screenshot of the truth table representing the constraint Pre\_WashGlass\_0 and explain what the different rows mean. \\
    \centerfig{0.6}{../figs/q2_2.png}
    \ans{
        The first row, with CleanGlass\_s0 = T and WashGlass\_s0 = T has a value of false in the 
        constraint, this is because you can't wash a glass that is already clean. You can only wash it 
        when is not clean, or not wash it at all this is represented by the next rows being set to true.
    }
    \item \textbf{6 points} Show a screenshot of the truth table representing the constraint Effect\_PracticedLaura\_1 and explain what the different rows mean (for this part, you only need to report and discuss the rows checked as “true” in the applet)\\
    \centerfig{0.6}{../figs/q2_3.png}
    \ans{
        In the first case we have everything set to True, and this is correct because PracticedLaura\_s0 
        was true so it doesn't matter that MakeBerry\_s0 was True, PracticedLaura\_s1 has to be True. \\ \\
        The second case is similar to the first one, except that PracticedLaura\_s0 is False, but this 
        doesn't matter because MakeBerry\_s0 = True forces PracticedLaura\_s1 to be True. \\ \\
        The third case that is true, occurs when PracticedLaura\_s0 was True, then PracticedLaura\_s0 is 
        also True even if MakeBerry\_s0 is false. \\ \\
        The last case is when Laura doesn't practice at all, PracticedLaura\_s0 and MakeBerry\_s0 are 
        False, so PracticedLaura\_s1 has no more option than remain False.
    }
    \item \textbf{5 points} Suppose neither Jane nor Laura have practiced making their cocktails. Also suppose that we are in a state with no vodka base, a dirty glass, but we have both Blue Curacao and Berry Liqueur. At what minimum horizon do we need to unroll the CSP if the goal is $PracticedLaura = T$ and $PracticedJane = T$? Give a plan to reach the goal, listing the action(s) taken at each step. \\ \\ Remember that to solve this problem as a CSP you need to define the features you want to hold in your start and goal states; in the AIspace STRIPS to CSP applet, you can do that via "create $\rightarrow$ set start state" and "create $\rightarrow$ set goal state". (You also set the horizon here.) After setting the start and goal state, when you click "solve $\rightarrow$ solve with arc consistency", the resulting CSP will have the desired constraints for start and goal states.\\
    \ans{
        The mininum horizon to reach the solution is 2. We can take the following actions:
        \begin{enumerate}[label=\arabic{*}.]
            \item MakeVodkaBase, WashGlass
            \item MakeBerry, MakeBlue
        \end{enumerate}
        The problem allow us to do this, because the actions MakeBerry and MakeBlue do not have 
        constraints on each other. So even it is imposible to do two different 
        cocktails with the same clean glass and vodka base, the problem has not the constraints to 
        manage this so we are able to reach the goal with just two steps.
    }
    \item \textbf{2 points} Explain why the plan you found in part (f) is inconsistent with the problem description given at the beginning of this question. (Note: you may find a bug in one of the constraint tables in this problem. That is not relevant to this question, and you may ignore it.)\\
    \ans{
        It is imposible to do two different cocktails with the same clean glass and vodka base. Furthermore 
        the problem description says that the DrinkUp Bartendering school has only one small 
        cocktail shaker that can only make one cocktail at a time. 
    }
    \item \textbf{2 points} Why does this issue happen with the CSP approach of solving this planning problem, and what can we do to the CSP to fix it?\\
    \ans{
        The problem is that the MakeBerry and MakeBlue must have a constraint between them, so  
        is not allowed to do one cocktail if the other one is being done. This can be fixed by adding 
        an extra constraint between MakeBerry and MakeBlue on every state, this constraint should 
        only allow \{ MakeBerry=T,MakeBlue=F \} or \{ MakeBerry=F,MakeBlue=T \} or \{ MakeBerry=F,MakeBlue=F \}
    }
\end{enumerate}

% ################################## QUESTION 3 ##################################
\clearpage
\section{Question 3 [23 points]: Propositional Definite Clauses - Proof Procedures}
Consider the following knowledge base KB.
\centerfig{0.2}{../figs/fig2}
\begin{enumerate}[label=(\alph*)]
    \item \textbf{5 points} Using the bottom-up proof procedure, list all of the atoms v such that KB $\vdash$ v. Show your work, using the numbers provided above to indicate which clauses are involved in each step of your work.\\
        \ans{
            Step 1:  \{ k \}  clause involved: 2 \\
            Step 2:  \{ k, s \}  clause involved: 11 \\
            Step 3:  \{ k, s, u \}  clause involved: 13 \\
            Step 4:  \{ k, s, u, q \}  clause involved: 10 \\
            Step 5:  \{ k, s, u, q, z \}  clause involved: 7 \\
            Step 6:  \{ k, s, u, q, z, j \}  clause involved: 1 \\
            Step 7:  \{ k, s, u, q, z, j, w \}  clause involved: 9 
        }
    \item \textbf{3 points} Is it true that for all these atoms v, KB $\vDash$ v? Why or why not?\\
        \ans{
          Yes, because the set of atoms v is true in every model of KB
        }
    \item \textbf{5 points}\\
    \begin{enumerate}[label=\roman*.]
        \item \textbf{3 points} Is it possible to pick an atom that is not a logical consequence of this KB, and give a model of that KB in which this atom is true? If yes, give the model. If no, explain why.\\
        \ans{
            Yes, atom m is not a logical consequence, and it can be true using the following representation:
        }
        \item \textbf{2 points} Provide an interpretation of the KB that is not a model (justify your answer).\\
        \ans{
            Any KB that is not a model, must have at least one clause that is false. In the interpretation provided below, every atom is false, this means that some of the clauses aren't true. An example of this is clause 11.
            % When every atom in the interpretation is false, then all clauses can't be true.
        }
    \end{enumerate}
    \item \textbf{10 points} Using the top-down resolution proof method, answer if the following queries are logical consequences of KB. If the answer is “yes” show the successful derivation; and if the answer is “no”, show one of the failing derivations.\\
    \begin{enumerate}[label=\roman*.]
        \item \textbf{5 points} ? m $\wedge$ j.\\
        \ans{
          It isn't a logical consequence: \\ \\
          yes $\leftarrow$ m $\wedge$ j. \\
          yes $\leftarrow$ w $\wedge$ q $\wedge$ p $\wedge$ j. \\
          \fbox{yes $\leftarrow$ u $\wedge$ x $\wedge$ q $\wedge$ p  $\wedge$ j.}
      } 
        \item \textbf{5 points} ? j $\wedge$ w.\\
        \ans{
          It is a logical consequence: \\ \\
          yes $\leftarrow$ j $\wedge$ w. \\
          yes $\leftarrow$ q $\wedge$ z $\wedge$ w\\
          yes $\leftarrow$ s $\wedge$ z $\wedge$ w\\
          yes $\leftarrow$ z $\wedge$ w\\
          yes $\leftarrow$ z $\wedge$ z\\
          yes $\leftarrow$ z \\
          yes $\leftarrow$ s \\
          yes $\leftarrow$ 
      }
    \end{enumerate}
\end{enumerate}

% ################################## QUESTION 4 ##################################
\clearpage
\section{4 [30 points]: Predicate Logic}
A priceless diamond, the Orange Ocelot, will be displayed at the Vancouver Jewel Museum. You have been hired to write the software for the security system that will be used to monitor the room holding the diamond for display. If some dastardly jewel thief attempts to steal the diamond, the system alarm must trigger. The system, museum, shown in the figure below, has three sensors:
\begin{enumerate}
    \item a “laser" motion sensor, laser
    \item a broken window sensor, window
    \item a door lock sensor, door
\end{enumerate}
\centerfig{0.7}{../figs/fig3.png}
The three sensors are wired in one circuit around the room as shown. The door sensor is connected directly to the power. The laser and the window are each preceded by circuit breakers, c1 and c2, which stop the power at that point if the fuse has blown. If they are “ok" the power flows through it to the next sensor. \\ \\
You will use the Definite Clause Deduction applet available at \texttt{http://www.aispace.org} to implement the system. This will involve writing a short set of axioms to define the problem and running some queries. First, take a look at the sample knowledge base called “An Electrical System" and understand how it works. You can use the “Move Subtree" button to get a better view of the answer to queries. Your program will use some of the same predicates used here to represent the flow of electricity through a set of switches and devices. You should use only (and all of) the following predicates for your system: \\ \\
\centerfig{0.7}{../figs/fig4.png}
Test out your system by stating different facts such as door\_open(door) and performing queries such as live(laser) or triggered(door). Remember that uppercase letters denote variables and lowercase denote particular values or instances. Make sure disabling a circuit breaker causes any dependent sensors to fail to trigger an alarm. \\ \\
\begin{enumerate}[label=(\alph*)]
    \item \textbf{15 points} Implement the system using the Definite Clause applet, and paste the contents of the .pl file you created into your submission.\\
    \begin{center}
        \lstinputlisting[firstline=3,lastline=18]{../code/q4.pl} 
    \end{center}
    \item \textbf{15 points} Provide a screen capture of the resulting proof deduction tree for the query alarm\_triggered(X) when the power is on, all the circuits are ok and the window is broken. You can get this by clicking on “View Proof Deduction" and then selecting the true node from the tree.\\
    \centerfig{1}{../figs/q4_1.png}
\end{enumerate}

\end{document}